{
  "address": "HUAq4NFymfn4hNvs7RMNCC5uFEoRctkWDWCA9G7prxeF",
  "metadata": {
    "name": "sour_handshake",
    "version": "0.1.0",
    "spec": "0.1.0",
    "description": "SOUR Protocol — The Handshake: P2P Escrow on Solana"
  },
  "instructions": [
    {
      "name": "initialize_config",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        { "name": "sour_mint", "writable": false },
        { "name": "keepers_pool", "writable": false },
        { "name": "commons_treasury", "writable": false },
        { "name": "authority", "writable": true, "signer": true },
        { "name": "system_program", "address": "11111111111111111111111111111111" }
      ],
      "args": [
        { "name": "pinch_bps", "type": "u16" },
        { "name": "burn_share_bps", "type": "u16" },
        { "name": "keepers_share_bps", "type": "u16" },
        { "name": "commons_share_bps", "type": "u16" }
      ]
    },
    {
      "name": "create_handshake",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "config.handshake_count" }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116] },
              { "kind": "account", "path": "config.handshake_count" }
            ]
          }
        },
        {
          "name": "vault_authority",
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116, 95, 97, 117, 116, 104] },
              { "kind": "account", "path": "config.handshake_count" }
            ]
          }
        },
        { "name": "creator_token_account", "writable": true },
        { "name": "worker" },
        { "name": "sour_mint" },
        { "name": "creator", "writable": true, "signer": true },
        { "name": "token_program", "address": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" },
        { "name": "system_program", "address": "11111111111111111111111111111111" },
        { "name": "rent", "address": "SysvarRent111111111111111111111111111111111" }
      ],
      "args": [
        { "name": "description", "type": "string" },
        { "name": "amount", "type": "u64" },
        { "name": "deadline_ts", "type": "i64" }
      ]
    },
    {
      "name": "accept_handshake",
      "discriminator": [],
      "accounts": [
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "worker", "signer": true }
      ],
      "args": []
    },
    {
      "name": "deliver",
      "discriminator": [],
      "accounts": [
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "worker", "signer": true }
      ],
      "args": []
    },
    {
      "name": "approve",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault_authority",
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116, 95, 97, 117, 116, 104] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "worker_token_account", "writable": true },
        { "name": "keepers_pool", "writable": true },
        { "name": "commons_treasury", "writable": true },
        { "name": "sour_mint", "writable": true },
        { "name": "creator", "signer": true },
        { "name": "token_program", "address": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" }
      ],
      "args": []
    },
    {
      "name": "dispute",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "signer", "signer": true }
      ],
      "args": []
    },
    {
      "name": "cancel",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault_authority",
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116, 95, 97, 117, 116, 104] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "creator_token_account", "writable": true },
        { "name": "creator", "signer": true },
        { "name": "token_program", "address": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" }
      ],
      "args": []
    },
    {
      "name": "resolve_dispute",
      "discriminator": [],
      "accounts": [
        {
          "name": "config",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [99, 111, 110, 102, 105, 103] }
            ]
          }
        },
        {
          "name": "handshake",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [104, 97, 110, 100, 115, 104, 97, 107, 101] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault",
          "writable": true,
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        {
          "name": "vault_authority",
          "pda": {
            "seeds": [
              { "kind": "const", "value": [118, 97, 117, 108, 116, 95, 97, 117, 116, 104] },
              { "kind": "account", "path": "handshake.id" }
            ]
          }
        },
        { "name": "creator_token_account", "writable": true },
        { "name": "worker_token_account", "writable": true },
        { "name": "keepers_pool", "writable": true },
        { "name": "commons_treasury", "writable": true },
        { "name": "sour_mint", "writable": true },
        { "name": "authority", "signer": true },
        { "name": "token_program", "address": "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" }
      ],
      "args": [
        { "name": "ruling", "type": "u8" }
      ]
    }
  ],
  "accounts": [
    {
      "name": "Handshake",
      "discriminator": [],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "id", "type": "u64" },
          { "name": "creator", "type": "pubkey" },
          { "name": "worker", "type": "pubkey" },
          { "name": "amount", "type": "u64" },
          { "name": "description", "type": "string" },
          { "name": "status", "type": { "defined": { "name": "HandshakeStatus" } } },
          { "name": "created_at", "type": "i64" },
          { "name": "deadline_ts", "type": "i64" },
          { "name": "accepted_at", "type": "i64" },
          { "name": "delivered_at", "type": "i64" },
          { "name": "resolved_at", "type": "i64" },
          { "name": "disputed_by", "type": "pubkey" },
          { "name": "vault_bump", "type": "u8" },
          { "name": "bump", "type": "u8" }
        ]
      }
    },
    {
      "name": "ProtocolConfig",
      "discriminator": [],
      "type": {
        "kind": "struct",
        "fields": [
          { "name": "authority", "type": "pubkey" },
          { "name": "sour_mint", "type": "pubkey" },
          { "name": "keepers_pool", "type": "pubkey" },
          { "name": "commons_treasury", "type": "pubkey" },
          { "name": "pinch_bps", "type": "u16" },
          { "name": "burn_share_bps", "type": "u16" },
          { "name": "keepers_share_bps", "type": "u16" },
          { "name": "commons_share_bps", "type": "u16" },
          { "name": "handshake_count", "type": "u64" },
          { "name": "total_burned", "type": "u64" },
          { "name": "total_to_keepers", "type": "u64" },
          { "name": "total_to_commons", "type": "u64" },
          { "name": "total_completed", "type": "u64" },
          { "name": "total_disputed", "type": "u64" },
          { "name": "bump", "type": "u8" }
        ]
      }
    }
  ],
  "events": [
    {
      "name": "HandshakeCreated",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "creator", "type": "pubkey", "index": false },
        { "name": "worker", "type": "pubkey", "index": false },
        { "name": "amount", "type": "u64", "index": false },
        { "name": "deadline_ts", "type": "i64", "index": false },
        { "name": "description", "type": "string", "index": false }
      ]
    },
    {
      "name": "HandshakeAccepted",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "worker", "type": "pubkey", "index": false },
        { "name": "accepted_at", "type": "i64", "index": false }
      ]
    },
    {
      "name": "WorkDelivered",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "worker", "type": "pubkey", "index": false },
        { "name": "delivered_at", "type": "i64", "index": false }
      ]
    },
    {
      "name": "HandshakeApproved",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "creator", "type": "pubkey", "index": false },
        { "name": "worker", "type": "pubkey", "index": false },
        { "name": "amount", "type": "u64", "index": false },
        { "name": "pinch_total", "type": "u64", "index": false },
        { "name": "burned", "type": "u64", "index": false },
        { "name": "to_keepers", "type": "u64", "index": false },
        { "name": "to_commons", "type": "u64", "index": false }
      ]
    },
    {
      "name": "HandshakeCancelled",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "creator", "type": "pubkey", "index": false },
        { "name": "cancelled_at", "type": "i64", "index": false }
      ]
    },
    {
      "name": "HandshakeDisputed",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "disputed_by", "type": "pubkey", "index": false },
        { "name": "disputed_at", "type": "i64", "index": false }
      ]
    },
    {
      "name": "DisputeResolved",
      "discriminator": [],
      "fields": [
        { "name": "handshake_id", "type": "u64", "index": false },
        { "name": "ruling", "type": "u8", "index": false },
        { "name": "resolved_at", "type": "i64", "index": false }
      ]
    },
    {
      "name": "ConfigInitialized",
      "discriminator": [],
      "fields": [
        { "name": "authority", "type": "pubkey", "index": false },
        { "name": "sour_mint", "type": "pubkey", "index": false },
        { "name": "pinch_bps", "type": "u16", "index": false }
      ]
    }
  ],
  "errors": [
    { "code": 6000, "name": "InvalidStatus", "msg": "Handshake is not in the expected status for this operation" },
    { "code": 6001, "name": "NotCreator", "msg": "Only the handshake creator can perform this action" },
    { "code": 6002, "name": "NotWorker", "msg": "Only the assigned worker can perform this action" },
    { "code": 6003, "name": "NotParticipant", "msg": "Only the creator or worker can perform this action" },
    { "code": 6004, "name": "SelfHandshake", "msg": "Worker address cannot be the same as the creator" },
    { "code": 6005, "name": "ZeroAmount", "msg": "Escrow amount must be greater than zero" },
    { "code": 6006, "name": "DescriptionTooLong", "msg": "Description is too long (max 280 characters)" },
    { "code": 6007, "name": "DeadlineInPast", "msg": "Deadline must be in the future" },
    { "code": 6008, "name": "HandshakeExpired", "msg": "Handshake has expired past its deadline" },
    { "code": 6009, "name": "DeadlineNotReached", "msg": "Handshake deadline has not yet passed" },
    { "code": 6010, "name": "InvalidFeeShares", "msg": "Fee shares must sum to 10000 basis points" },
    { "code": 6011, "name": "InvalidPinchBps", "msg": "Pinch fee basis points must be between 0 and 5000 (50%)" },
    { "code": 6012, "name": "InsufficientEscrow", "msg": "Insufficient escrow balance for transfer" },
    { "code": 6013, "name": "InvalidRuling", "msg": "Invalid dispute ruling — must be 0 (refund) or 1 (pay worker)" },
    { "code": 6014, "name": "NotAuthority", "msg": "Only the protocol authority can perform this action" },
    { "code": 6015, "name": "MathOverflow", "msg": "Arithmetic overflow in fee calculation" }
  ],
  "types": [
    {
      "name": "HandshakeStatus",
      "type": {
        "kind": "enum",
        "variants": [
          { "name": "Created" },
          { "name": "Accepted" },
          { "name": "Delivered" },
          { "name": "Approved" },
          { "name": "Disputed" },
          { "name": "Cancelled" },
          { "name": "Resolved" },
          { "name": "Expired" }
        ]
      }
    }
  ]
}
